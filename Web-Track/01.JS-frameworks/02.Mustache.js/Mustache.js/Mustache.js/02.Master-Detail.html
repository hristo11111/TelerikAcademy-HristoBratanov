<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script src="Scripts/class.js"></script>
    <script src="Scripts/jquery-2.0.3.js"></script>
    <script src="Scripts/mustache.js"></script>
    <script src="Scripts/list-view.js"></script>
    <style>
        ul, li, div, strong {
            margin: 0;
            padding: 0;
        }

        #students-summarized {
            float: left;
            margin-right: 50px;
        }
    </style>
</head>
<body>
    <div id="students-summarized"></div>
    <div id="students-marks"></div>
    <script type="x-students-complexview" id="students-complex">
        <strong><a href="#">{{fullname}}</a></strong>
        <ul>
            <li>grade: {{grade}}</li>
            <li>age: {{age}}</li>
        </ul>
        <div id="marks" style="display:none">
            {{#marks}}
            <ul>
                <li><strong>{{subject}}</strong> - {{score}}</li>
            </ul>
            {{/marks}}
            {{^marks}}
            <span>The student does not have any marks</span>
            {{/marks}}
        <div>
    </script>
    <script>
        var Student = Class.create({
            init: function (fname, lname, grade, age, marks) {
                this.fname = fname,
                this.lname = lname,
                this.grade = grade,
                this.age = age,
                this.marks = marks
            },

            fullname: function () {
                return this.fname + " " + this.lname;
            }
        });

        var Mark = Class.create({
            init: function(subject, score) {
                this.subject = subject,
                this.score = score
            }
        });

        var students = [
            new Student("Doncho", "Minkov", 5, 15, [new Mark("Math", 4), new Mark("JavaScript", 6)]),
			new Student("Nikolay", "Kostov", 6, 16, [new Mark("MVC", 6), new Mark("JavaScript", 5)]),
			new Student("Ivaylo", "Kendov", 8, 12, [new Mark("OOP", 4), new Mark("C#", 6)]),
			new Student("Svetlin", "Nakov", 9, 25, [new Mark("Unit Testing", 5), new Mark("WPF", 6)]),
			new Student("Asya", "Georgieva", 4, 9, [new Mark("Automation Testing", 6), new Mark("Manual Testing", 4)]),
			new Student("Georgi", "Georgiev", 12, 24)
        ];

        var complexTemplate = Mustache.compile(document.getElementById("students-complex").innerHTML);
        var listView = controls.getListView(students);

        var complexContainer = document.getElementById("students-summarized");
        complexContainer.innerHTML = listView.render(complexTemplate);
        
        document.getElementById("students-summarized").onclick = function (ev) {
            if (ev.target instanceof HTMLAnchorElement) {
                var markselement = ((ev.target.parentNode).parentNode).lastChild;
                var marksCOntainer = document.getElementById("students-marks");
                marksCOntainer.innerHTML = markselement.innerHTML;
            }
        }

    </script>
</body>
</html>
